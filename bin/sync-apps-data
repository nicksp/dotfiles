#!/bin/bash
#
# Synchronize apps data with a custom local folder that I back up frequently to an external drive.
#
# - Run the synchronization:
#
# `sync-apps-data`
#
# ---
# Author: Nick Plekhanov, https://plekhanov.me
# License: MIT
# https://github.com/nicksp/dotfiles

set -eu

CYAN="$(tput setaf 6)"
UNDERLINE="$(tput sgr 0 1)"
RESET="$(tput sgr0)"

title() {
  echo -e "${UNDERLINE}${CYAN}${1}${RESET}\n"
}

_bk() {
  title "Backing up $3â€¦"
  dest_dir="$2"
  mkdir -p "$dest_dir"

  # Remove any files/directories in the destination that are not in the source
  for item in "$dest_dir"/*; do
    if [ ! -e "$1/$(basename "$item")" ]; then
      rm -rf "$item"
    fi
  done

  # Copy files/directories from the source to the destination
  for item in "$1"/*; do
    if [ -d "$item" ]; then
      cp -R "$item" "$dest_dir"
    else
      cp "$item" "$dest_dir"
    fi
  done

  title "Done ðŸ¦œ"
}

# Obsidian settings synchronization
_bk "$HOME/Library/Mobile Documents/iCloud~md~obsidian/Documents/Chest/.obsidian" "$HOME/dotfiles/obsidian/.obsidian" "Obsidian configs"
# Obsidian templates and bases synchronization
_bk "$HOME/Library/Mobile Documents/iCloud~md~obsidian/Documents/Chest/ðŸ¥’ Extras" "$HOME/dotfiles/obsidian/ðŸ¥’ Extras" "Obsidian templates and bases"

# Obsidian notes/images synchronization
_bk "$HOME/Library/Mobile Documents/iCloud~md~obsidian/Documents/Chest" "$HOME/Documents/MYDATA/Obsidian" "Obsidian vault content"
